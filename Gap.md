# Gap Log

## システム構成
- **タイルサイズ**: デザイン上は 32px だが、現コードでは 40px タイルを採用して UI レイアウトを維持。
- **占有モデル**: デザインにはないが `game_state.js` でレイヤ付き占有テーブルを導入し、NPC/敵/入口に対する重なり禁止とイベント優先度（敵→ワープ→その他）を実装。

## 入出力・UI
- **操作キー**: T/I/U/S/A/D/R は仕様通り。Enter は決定キーではなく「一部メッセージ操作のみ」、Esc は overlay を閉じる用途に限定。
- **メッセージ/UI**: 画面構成は準拠。ただしログ保持は 3 行固定で、デザインで想定している詳細ステータス表示やロングログは未導入。

## 経済・アイテム
- **ショップ**: Buy/Sell と価格は仕様通り。ただし会話テキスト、在庫制御、価格変動は実装していない。
- **Food×10**: デザイン通りインベントリを使わず Food 数値に直接加算。
- **Ancient Key**: フラグのみ存在し、入手/使用イベントは未実装。

## 戦闘・敵配置
- **敵データ**: ENEMY_DATA は設計値に基づくが、現状はステータス範囲を固定乱数化し、特殊行動/ドロップは未実装。
- **敵スポーン**: フィールドのみ 3〜5 体を常駐。入口/扉/遺跡周辺では占有テーブルの予約により生成/侵入しない。DRAGON は固定 1 体。
- **戦闘**: A/D/R 行動と勝敗判定、勝利報酬（EXP/Gold/HP+3）、敗北時の安全復帰を実装。戦闘ログはメッセージパネル共有。

## イベント進行
- **鍵/遺跡**: `state.flags.hasKey` などのフラグは保持するが、洞窟宝箱イベント・鍵使用・遺跡クリア演出は未実装。
