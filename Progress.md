# Progress

## 概要
- FIELD / VILLAGE / CAVE の 3 シーンを 24x18 タイルで構築し、入口タイル経由で相互遷移できる探索ループを実装。
- 占有テーブルとカメラ描画により NPC・敵シンボル・宝箱・遺跡などのランドマークを安全に配置。
- Food 消費、ショップ購入/売却、インベントリと装備トグルにより基本的なリソース循環が完成。
- フィールド／洞窟に敵シンボルを常駐させ、A/D/R のターン制戦闘・勝敗処理・報酬・レベルアップを実装。
- 洞窟の宝箱で Ancient Key を入手し、遺跡タイルで鍵チェック→クリア演出→Enter リスタートまでのフローを新規実装。

## 実装状況とギャップ
| カテゴリ | 設計意図 (GAME_DESIGN.md) | 現状実装 | 残課題 |
| --- | --- | --- | --- |
| シーン構成 | FIELD / VILLAGE / CAVE を 24x18 タイルで用意し、入口タイルで遷移 | `map_data.js` で 3 シーンのタイル・スポーン・ワープ・イベント座標を実装済み | 村内施設や追加シーンの拡張は未着手 |
| タイル / 描画 | タイル 32px・画面 800x360・ランドマークを重ね描き | tileSize=40 とスクロールカメラで表示、ランドマークは emoji で重ね表示 | タイルサイズが設計値と異なる（32px→40px） |
| 移動 / イベント | 矢印キー移動・通行不可タイル・入口接触でイベント処理 | `input.js` と占有テーブルで移動可否を判定し、入口/敵/宝箱/遺跡をイベント順序（敵→ワープ→その他）で処理 | 今後追加予定の宝物・会話イベントは未実装 |
| 資源管理 | HP/ATK/DEF/LV/EXP/Food/Gold、FIELD/CAVE で 2 歩ごとに Food 消費、Food 0 で HP 減少 | 初期値 (HP30/ATK5/DEF3/Food50/Gold50) と `handleFoodCost` で仕様通りの消費・ダメージを実装 | ストーリー報酬や追加リソース調整イベントは未着手 |
| ショップ / インベントリ | T で会話 → Buy/Sell、価格は設計値、インベントリ 6 枠、Potion/武器/盾/Key を管理 | 商人隣接で `shop.tryOpen`、Buy/Sell/売値 50%/所持枠チェック、インベントリ表示・装備トグル・Potion 使用を実装 | 会話テキスト分岐や在庫変動など演出面は未整備 |
| 戦闘 / 敵 | フィールドに敵シンボル常駐、接触で A/D/R のターン制、勝利/敗北処理、敵データ表 | `entities.js` で FIELD3-5 体・CAVE2-4 体・ドラゴン固定スポーン、`combat.js` で A/D/R・勝利報酬・敗北復帰を実装 | 敵の特殊行動やドロップ差分など高難度要素は未実装 |
| UI / 操作 | マップ + メッセージ + ステータス + コマンドの 3 パネル、キー T/I/U/S と A/D/R/Enter/Esc | `renderer.js` で 3 パネルと Shop/Inventory/Status/Battle overlay、クリアオーバーレイを描画。T/I/S/A/D/R/Esc/Enter が設計通り動作 | U キー単独使用や Enter 決定操作の詳細仕様は要調整余地あり |
| 進行イベント | 洞窟宝箱で Ancient Key 入手 → 遺跡で使用してクリア演出 | `Game.flags` と `Game.EVENTS` を用いた宝箱開封・鍵保持・遺跡開門・クリア演出・再スタートを実装 | 独自演出（カットシーンや追加メッセージ）の拡張は未実装 |
