# Ultima-like MVP Design (p5.js)
Version: 0.1 / Target: Browser / Canvas: 800x600 / Grid: 24x18 (tile 32px)

## 0. 目的（ゲームの目的）
- **世界観**：小さな島に漂着した冒険者（🧝）が生存を図りながら島の謎を解く。
- **最終目標（MVP）**：洞窟で **Ancient Key** を入手し、**遺跡（🏛️）の門を開いて中枢に到達**する。
- **コアループ**：探索 → 戦闘 → 補給（商人🧙‍♂️）・装備更新 → 鍵入手 → 遺跡到達 → クリア。
- **勝利条件（MVP）**：鍵を所持して🏛️に接触するとクリア演出。
- **敗北条件**：HP=0（戦闘不能）／Food=0の状態で行動し続けて餓死（HPが尽きる）。
- **制約**：FoodとGoldをやりくりし、強敵（🐉など）を回避・準備して進む。

## 1. シーン（3枚マップ）
| シーン   | 役割                                          | サイズ | 主な要素                                               | 敵   | Food |
|---------|-----------------------------------------------|--------|--------------------------------------------------------|------|------|
| FIELD   | 島全景。探索と戦闘、洞窟/遺跡/村の入口        | 24x18 | 草/道/水（色）、⛰️🪨🌲、🏘️、🕳️、🏛️、敵               | あり | あり（2歩=1） |
| VILLAGE | 安全地帯。商人がいる                           | 24x18 | 屋外は草/道（色）、建物内部は床色＋🧱🚪、🧙‍♂️          | なし | なし |
| CAVE    | 洞窟ミニ区画。鍵の宝箱                         | 24x18 | 洞窟床（濃灰色）、🪨、🕳️、📦（宝箱）                  | あり | あり |

- 遺跡（🏛️）はFIELD上のゴール。鍵所持でクリア。  
- ワープ：FIELD→VILLAGE=🏘️、VILLAGE→FIELD=外門🚪、FIELD↔CAVE=🕳️、FIELD→CLEAR=🏛️（鍵）

## 2. 表示仕様
- タイル 32px、画面 800x600。  
- レイアウト：上マップ 800x360（24x18）、中左メッセージ 400x120（最新3行）、中右ステータス 400x120（HP/LV/EXP/Food/Gold/ATK/DEF/装備）、下コマンド 800x120。

### 地形（色）
- Grass `#7CCB5B` / Road `#B57A43` / Water `#2F6DD5`  
- Indoor Floor `#8B4B4B` / Cave Floor `#444444` / Sand `#D9C37A`（任意）

### フィールドに描画する絵文字
- プレイヤー：🧝  
- 商人：🧙‍♂️  
- 敵（弱→強）：🫠, 🦇, 🕷, 👻, 🧛‍♂️, 🧌, 🐉  
- 自然/ランドマーク：⛰️, 🪨, 🌲（装飾）, 🏘️（入口）, 🕳️（洞窟口）, 🏛️（遺跡）  
- 建物（村の中）：🧱（外壁/通行不可）, 🚪（扉/通行可）

### 通行・衝突
- 不可：⛰️, 🪨, 🧱, 🏛️（外郭）  
- 可＋イベント：🚪（出入口）, 🕳️（洞窟出入口）, 🏛️（鍵チェック）  
- 装飾（可）：🌲, 🏘️  
- キャラ/NPC/敵：タイル占有（接触で会話/戦闘）

## 3. 操作（キーバインド）
- 移動：Arrow Keys（4方向）  
- フィールド：`T` Talk（商人）、`I` Items、`U` Use（選択中の消費）、`S` Stats（オーバーレイ）  
- 戦闘：`A` Attack、`D` Defend、`R` Run  
- 共通：`Enter` 決定、`Esc` キャンセル  
- 画面遷移：タイル接触（🏘️/🕳️/🏛️/🚪）

## 4. プレイヤー／リソース
HP/MaxHP, ATK, DEF, LV, EXP, Food, Gold, equip.weapon(ATK+), equip.shield(DEF+), inventory（最大6枠）

- 初期：HP=30, ATK=5, DEF=3, LV=1, EXP=0, **Food=50, Gold=50**  
- レベルアップ（固定成長）：しきい値例 10, 30, 60, 100...  
  - 上昇：**HP+5, ATK+1, DEF+1**  
- **Food消費**：FIELD/CAVEで **2歩=1**。VILLAGE/メニュー/戦闘は消費しない  
  - Food=0：行動ごとに **HP-1**  
- 回復：ポーション（+20HP）、戦闘勝利時に微回復（+3HP）

## 5. 経済（Food/Gold）
- Gold：戦闘/宝箱/売却で増、購入で減  
- Food：商人から購入（数値リソース、上限999）

**価格（MVP）**
- Food×10 … 10G  
- Potion（+20HP） … 15G  
- Bronze Sword（ATK+2） … 40G  
- Wood Shield（DEF+2） … 35G

- 売却：原則 50%（装備中は売却不可）  
- インベントリ：6枠（装備は枠外）

## 6. 商人（VILLAGE）
- 隣接して `T` で会話 → **Buy/Sell** メニュー  
- Buy：商品選択→価格提示→`Enter`確定（不足/満杯は警告）  
- Sell：所持品一覧→売値提示→確定（装備は外してから）

## 7. 戦闘（MVP）
- シンボル接触で開始（画面切替なし、その場でターン制）  
- 順番：**Player → Enemy → …**（固定）

**行動**
- **A**：`damage = max(1, ATK + rnd(0..2) - ENEMY.DEF)`  
- **D**：そのターン被ダメ **半減（切上）**  
- **R**：**50%** で離脱（失敗で敵行動）

- 勝利：`EXP + Gold (+微回復、低確率で Food/Potion)`  
- 敗北：HP=0 → タイトル（MVPは再開未実装）

## 8. 敵（弱→強）と目安値
> まずは **HP/ATK/DEFのみ**。特殊効果は後でON。

| ID      | 絵文字 | 立ち位置 | HP   | ATK | DEF | EXP | Gold | 主な出現           |
|---------|-------|---------|-----:|----:|----:|----:|----:|--------------------|
| SLIME   | 🫠    | 最弱    | 10–14| 2–3 | 0   | 4–6 | 6–10| 草/道（多）        |
| BAT     | 🦇    | 下位    | 12–16| 3–4 | 0–1 | 6–8 | 8–12| 森/洞窟口          |
| SPIDER  | 🕷    | 中位-   | 18–22| 4–5 | 1–2 | 8–10|10–14| 森/岩場            |
| GHOST   | 👻    | 中位    | 22–26| 5–6 | 1–2 |10–12|12–16| 洞窟口/遺跡周辺    |
| VAMPIRE | 🧛‍♂️ | 上位    | 30–36| 6–7 | 2–3 |14–18|16–22| 遺跡寄り           |
| TROLL   | 🧌    | 強敵    | 38–46| 7–8 | 3–4 |18–24|20–28| 山沿い             |
| DRAGON  | 🐉    | 最強    | 60–80| 9–11| 4–5 |30–40|35–50| 遺跡手前（固定1）  |

## 9. 進行・クリア
1) FIELD を探索し、VILLAGE で補給/装備更新  
2) CAVE の宝箱（📦）から **Ancient Key**（初回のみ）を入手  
3) FIELD の 🏛️ に接触（鍵チェック）→ クリア演出 → 終了

## 10. データ仕様（実装指針）
- **ID**  
  SCENE = { FIELD, VILLAGE, CAVE }  
  TILE = { GRASS, ROAD, WATER, FLOOR_IN, FLOOR_CAVE, MOUNTAIN, ROCK, TREE, WALL, DOOR, ENTRANCE_VIL, ENTRANCE_CAVE, RUINS }  
  ENTITY = { PLAYER, MERCHANT, SLIME, BAT, SPIDER, GHOST, VAMPIRE, TROLL, DRAGON }  
  ITEM = { FOOD10, POTION, BRONZE_SWORD, WOOD_SHIELD, ANCIENT_KEY }
- **色タイル**：`TILE_COLOR[tileId] -> hex`  
- **絵文字**：`EMOJI[id] -> "🧝"` など  
- **マップ**：`sceneMap[SCENE] -> 24x18 の tileId 配列＋入口座標`  
- **敵ポップ**：FIELD 常時 3–5 体（撃破→歩数でリポップ）  
- **ショップ表**：`PRICE[itemId]`（売値=買値×0.5）  
- **状態**：プレイヤー、シーン、座標、敵リスト、メッセージ配列（直近3）、`hasKey`

## 11. テスト項目（MVP完了）
- Food：FIELD/CAVEのみ減少、0で行動毎にHP-1  
- 戦闘：最低与ダメ=1、Dで半減、Rは50%、勝利でEXP/Gold/微回復  
- 売買：金不足/満杯の警告、装備中は売却不可、Foodは数値加算  
- 進行：洞窟宝箱=鍵1回限り、🏛️で確実にクリア  
- ワープ：出入口ペアで元の入口に戻る

## 12. 今後の拡張（MVP後）
- Magic/MP（Fire/Heal）
- 商人拡張（価格変動/在庫/割引）
- 装備上位・会心/状態異常
- セーブ/ロード・BGM/SE・複数マップ
